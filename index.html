<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiggy - Quản lý tài chính cá nhân</title>
    <link rel="stylesheet" href="./bootstrap-5.3.3-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./fontawesome-free-6.5.2-web/css/all.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/jquery-3.7.1.js"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sedan+SC&display=swap" rel="stylesheet">
    <!-- Fonts -->
</head>

<body>

    <header class="header">
        <section class="header-logo">
            <i class="fa-solid fa-piggy-bank"></i>
            Spiggy
        </section>
        <section class="header-right">
            <section class="header-right-time">
                <i style="margin-right: 5px;" class="fa-solid fa-calendar-days"></i>
                <span id="header-date"></span>
            </section>
            <section class="header-right-account">
                <i style="margin-right: 5px;" class="fa-solid fa-user"></i>
                <div class="dropdown">
                    <span id="name-user" class="dropdown-toggle" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        Đào Xuân Phượng
                    </span>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="#">
                                <i class="fa-solid fa-gear"></i>
                                Cài đặt
                            </a>
                        </li>
                        <li><a class="dropdown-item" href="./view/signin.html">
                                <i class="fa-solid fa-right-from-bracket"></i>
                                Đăng xuất
                            </a>
                        </li>
                    </ul>
                </div>
            </section>
        </section>
    </header>

    <main class="content">
        <div class="row">
            <div class="col-3">
                <ul class="list-group">
                    <li data-num="1" class="list-group-item list-item-control active">Bảng điều khiển</li>
                    <li data-num="2" class="list-group-item list-item-control">Khoản thu</li>
                    <li data-num="3" class="list-group-item list-item-control">Khoản chi</li>
                    <li data-num="4" class="list-group-item list-item-control">Khoản vay</li>
                    <li data-num="5" class="list-group-item list-item-control">Mục tiêu</li>
                </ul>
                <section class="slider">
                    <div id="carouselExampleAutoplaying" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            <!-- Banner -->
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </section>
            </div>
            <div class="col-9">
                <section data-num="1" class="content-item content-item-active">
                    <div class="row list-card">
                        <!-- Dữ liệu mẫu giao dịch -->
                        <div class="col-3">
                            <div class="card">
                                <section style="background-color: #009D55;" class="card-icon">
                                    <i class="fa-solid fa-money-check-dollar"></i>
                                </section>
                                <div style="background-image: linear-gradient(to right, #00C76C, #00A95B);"
                                    class="card-body">
                                    <h5 class="card-title">Tổng thu nhập</h5>
                                    <p class="card-text">
                                        10.000.000 VND
                                        <br>
                                        Còn dư: 20.000.000 VND
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="card">
                                <section class="card-icon">
                                    <i class="fa-solid fa-money-check-dollar"></i>
                                </section>
                                <div class="card-body">
                                    <h5 class="card-title">Tài khoản ví Tiết kiệm</h5>
                                    <p class="card-text">6.000.000 VND</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="card">
                                <section style="background-color: #951144;" class="card-icon">
                                    <i class="fa-solid fa-money-check-dollar"></i>
                                </section>
                                <div style="background-image: linear-gradient(to right, #CB196D, #B91560);"
                                    class="card-body">
                                    <h5 class="card-title">Tài khoản ví Mục tiêu</h5>
                                    <p class="card-text">30.000.000 VND</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="card">
                                <section style="background-color: #005F97;" class="card-icon">
                                    <i class="fa-solid fa-money-check-dollar"></i>
                                </section>
                                <div style="background-image: linear-gradient(to right, #0088DA, #0074B9);"
                                    class="card-body">
                                    <h5 class="card-title">Tài khoản ví Vay</h5>
                                    <p class="card-text">60.000.000 VND</p>
                                </div>
                            </div>
                        </div>

                        <!-- Thêm thẻ cho các danh mục khác -->
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <table class="table table-info table-striped">
                                <thead>
                                    <tr>
                                        <th scope="col">Tháng</th>
                                        <th scope="col">Thu nhập</th>
                                        <th scope="col">Chi tiêu</th>
                                        <th scope="col">Chênh lệch</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th scope="row">1</th>
                                        <td>20.000.000</td>
                                        <td>10.000.000</td>
                                        <td>10.000.000</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">2</th>
                                        <td>22.000.000</td>
                                        <td>9.000.000</td>
                                        <td>13.000.000</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">3</th>
                                        <td>26.000.000</td>
                                        <td>11.000.000</td>
                                        <td>15.000.000</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">4</th>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">5</th>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">6</th>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">7</th>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">8</th>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">9</th>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">10</th>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">11</th>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">12</th>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-6">
                            <section>
                                <canvas id="chart1" style="width:100%;
                                    height:500px"></canvas>
                            </section>
                        </div>
                    </div>
                </section>
                <section data-num="2" class="content-item">
                    <div class="income-form">
                        <input type="text" id="name" placeholder="Tên thu nhập">
                        <input type="date" id="date">
                        <input type="number" id="amount" placeholder="Số tiền">
                        <button id="add-btn">Thêm</button>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Tên thu nhập</th>
                                <th>Ngày</th>
                                <th>Số tiền</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="income-table-body"></tbody>
                    </table>
                </section>
                <section data-num="3" class="content-item">
                    <div class="row list-item-budget">
                        <div class="col-3">
                            <div div class="card">
                                <section class="card-icon">
                                    <i class="fa-solid fa-money-check-dollar"></i>
                                </section>
                                <div class="card-body">
                                    <h5 class="card-title">Ăn uống</h5>
                                    <p class="card-text">3.000.000 VND</p>
                                </div>

                            </div>
                        </div>
                        <div class="col-3">
                            <div class="card">
                                <section class="card-icon">
                                    <i class="fa-solid fa-money-check-dollar"></i>
                                </section>
                                <div class="card-body">
                                    <h5 class="card-title">Xe cộ</h5>
                                    <p class="card-text">500.000 VND</p>
                                </div>

                            </div>
                        </div>
                        <div class="col-3">
                            <div class="card">
                                <section class="card-icon">
                                    <i class="fa-solid fa-money-check-dollar"></i>
                                </section>
                                <div class="card-body">
                                    <h5 class="card-title">Tiền nhà</h5>
                                    <p class="card-text">4.000.000 VND</p>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="form-container">
                        <h2 class="form-title">Ngân sách tự chi/tháng</h2>
                        <form id="budgetForm" class="budget-form">
                            <div class="form-group">
                                <label for="budgetName" class="form-label">Tên ngân sách:</label>
                                <input type="text" id="budgetName" name="budgetName" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="amount" class="form-label">Số tiền:</label>
                                <input type="number" id="amount" name="amount" class="form-input" required>
                            </div>
                            <input type="submit" value="Tạo ngân sách" class="form-submit">
                        </form>
                    </div>

                    <div>
                        <div class="expense-form">
                            <input type="text" id="expense-name" placeholder="Tên chi phí">
                            <input type="date" id="expense-date">
                            <select id="expense-type">
                                <option value="Food">Ví Tổng thu nhập</option>
                                <option value="Transport">Ví Tiết kiệm</option>
                                <option value="Utilities">Ví Đầu tư</option>
                                <option value="Others">Ví Vay</option>
                            </select>
                            <input type="number" id="expense-amount" placeholder="Số tiền">
                            <button id="add-expense-btn">Thêm</button>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th>Tên chi phí</th>
                                    <th>Ngày</th>
                                    <th>Ví thanh toán</th>
                                    <th>Số tiền</th>
                                    <th>Hoạt động</th>
                                </tr>
                            </thead>
                            <tbody id="expense-table-body"></tbody>
                        </table>
                    </div>
                </section>
                <section data-num="4" class="content-item">
                    Vay
                </section>
                <section data-num="5" class="content-item">
                    <div class="goal-form-container">
                        <h2 class="goal-form-title">Mục tiêu</h2>
                        <form id="goalForm" class="goal-form">
                            <div class="goal-form-group">
                                <label for="goalName" class="goal-form-label">Tên mục tiêu:</label>
                                <input type="text" id="goalName" name="goalName" class="goal-form-input" required>
                            </div>
                            <div class="goal-form-group">
                                <label for="goalAmount" class="goal-form-label">Số tiền mục tiêu:</label>
                                <input type="number" id="goalAmount" name="goalAmount" class="goal-form-input" required>
                            </div>
                            <div class="goal-form-group">
                                <label for="deadline" class="goal-form-label">Hạn chót:</label>
                                <input type="date" id="deadline" name="deadline" class="goal-form-input" required>
                            </div>
                            <input type="submit" value="Lưu mục tiêu" class="goal-form-submit">
                        </form>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <script src="./bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script>
        $(document).ready(function () {
            // Get date
            let date = new Date();
            let day = date.getDate();
            let month = date.getMonth() + 1;
            if (month < 10) {
                month = "0" + month;
            }
            let year = date.getFullYear();
            $("#header-date").html(`${day}/${month}/${year}`);

            //Chart 1
            var xValues = ["Ăn uống", "Xe cộ", "Tiền nhà", "Cafe với bạn bè"];
            var yValues = [50000, 20000, 130000, 45000];
            var barColors = ["red", "green", "blue", "orange"];

            new Chart("chart1", {
                type: "bar",
                data: {
                    labels: xValues,
                    datasets: [{
                        backgroundColor: barColors,
                        data: yValues
                    }]
                },
                options: {
                    legend: { display: false },
                    title: {
                        display: true,
                        text: "Chi tiêu hôm nay",
                        fontSize: 24
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
            });

            // Click sidebars
            $(".list-item-control").click(function () {
                const listItemControl = $(".list-item-control");
                listItemControl.removeClass("active");
                $(this).addClass("active");

                const contentItem = $(".content-item");
                contentItem.removeClass("content-item-active");
                let dataNum = $(this).attr("data-num");
                $(`.content-item[data-num=${dataNum}]`).addClass("content-item-active");
            });

            // Get ads from local storage
            let arrayImg = [
                "car_1.jpg",
                "car_2.jpg",
                "car_3.png",
            ];
            const advertisementData = localStorage.getItem("ads");
            if (advertisementData) {
                const advertisement = JSON.parse(advertisementData);
                const images = advertisement.images;

                const carouselInner = $('.carousel-inner');
                carouselInner.empty(); // Xóa bỏ các item cũ trong carousel trước khi thêm mới

                for (let i = 0; i < images.length; i++) {
                    const imageUrl = images[i]; // Lấy đường dẫn đến ảnh từ dữ liệu localStorage
                    const carouselItem = $('<div class="carousel-item"></div>');
                    const img = $('<img class="d-block w-100">');
                    img.attr('src', imageUrl);
                    carouselItem.append(img);

                    // Thêm lớp 'active' cho carousel item đầu tiên
                    if (i === 0) {
                        carouselItem.addClass('active');
                    }
                    carouselInner.append(carouselItem);
                }
            } else {
                // Hiển thị ảnh từ mảng arrayImg
                const carouselInner = $('.carousel-inner');
                carouselInner.empty(); // Xóa bỏ các item cũ trong carousel trước khi thêm mới

                for (let i = 0; i < arrayImg.length; i++) {
                    const imageUrl = `./img/${arrayImg[i]}`;
                    const carouselItem = $('<div class="carousel-item"></div>');
                    const img = $('<img class="d-block w-100">');
                    img.attr('src', imageUrl);
                    carouselItem.append(img);

                    // Thêm lớp 'active' cho carousel item đầu tiên
                    if (i === 0) {
                        carouselItem.addClass('active');
                    }
                    carouselInner.append(carouselItem);
                }
            }


            //Handle create budget
            $("#budgetForm").submit(function (event) {
                event.preventDefault();

                // Lấy dữ liệu từ form
                var budgetName = $("#budgetName").val();
                var amount = $("#amount").val();

                // Tạo một mục ngân sách mới
                var newItem = `
            <div class="col-3">
                <div class="card">
                    <section class="card-icon">
                        <i class="fa-solid fa-money-check-dollar"></i>
                    </section>
                    <div class="card-body">
                        <h5 class="card-title">${budgetName}</h5>
                        <p class="card-text">${amount} VND</p>
                    </div>
                </div>
            </div>
        `;

                // Thêm mục ngân sách mới vào danh sách
                $(".list-item-budget").append(newItem);

                // Đặt lại form
                $("#budgetForm")[0].reset();
            });







            //Handle CRUD incom
            // Dữ liệu mẫu ban đầu
            var incomes = [
                { name: 'Lương', date: '2024-06-01', amount: '5000000' },
                { name: 'Thưởng', date: '2024-06-02', amount: '1000000' }
            ];

            // Hiển thị dữ liệu
            function displayIncomes() {
                $("#income-table-body").empty();
                $.each(incomes, function (index, income) {
                    $("#income-table-body").append("<tr><td>" + income.name + "</td><td>" + income.date + "</td><td>" + income.amount + "</td><td><button class='edit-btn' data-index='" + index + "'>Sửa</button><button class='delete-btn' data-index='" + index + "'>Xóa</button></td></tr>");
                });
            }

            displayIncomes();

            // Thêm thu nhập mới
            $("#add-btn").click(function () {
                var name = $("#name").val();
                var date = $("#date").val();
                var amount = $("#amount").val();

                // Validate dữ liệu
                if (name === "" || date === "" || amount === "") {
                    alert("Vui lòng nhập đủ thông tin.");
                    return;
                }

                // Thêm vào mảng và hiển thị lại
                incomes.push({ name: name, date: date, amount: amount });
                displayIncomes();

                // Xóa nội dung của các trường nhập
                $("#name").val("");
                $("#date").val("");
                $("#amount").val("");
            });

            // Sửa thu nhập
            $(document).on("click", ".edit-btn", function () {
                var index = $(this).data("index");
                var income = incomes[index];

                // Hiển thị dữ liệu trên form nhập
                $("#name").val(income.name);
                $("#date").val(income.date);
                $("#amount").val(income.amount);

                // Ẩn nút Thêm và hiển thị nút Cập nhật
                $("#add-btn").hide();
                $("#update-btn").remove();
                $(".income-form").append("<button id='update-btn'>Cập nhật</button>");

                // Xử lý sự kiện khi nhấn nút Cập nhật
                $("#update-btn").click(function () {
                    var name = $("#name").val();
                    var date = $("#date").val();
                    var amount = $("#amount").val();

                    // Validate dữ liệu
                    if (name === "" || date === "" || amount === "") {
                        alert("Vui lòng nhập đủ thông tin.");
                        return;
                    }

                    // Cập nhật dữ liệu và hiển thị lại
                    incomes[index] = { name: name, date: date, amount: amount };
                    displayIncomes();

                    // Xóa nội dung của các trường nhập và hiển thị lại nút Thêm
                    $("#name").val("");
                    $("#date").val("");
                    $("#amount").val("");
                    $("#add-btn").show();
                    $("#update-btn").remove();
                });
            });

            // Xóa thu nhập
            $(document).on("click", ".delete-btn", function () {
                if (confirm("Bạn có chắc chắn muốn xóa mục này không?")) {
                    var index = $(this).data("index");
                    incomes.splice(index, 1);
                    displayIncomes();
                }
            });

            //Handle expense
            // Dữ liệu mẫu ban đầu
            var expenses = [
                { name: 'Mua thức ăn', date: '2024-06-01', type: 'Food', amount: '500000' },
                { name: 'Chi phí di chuyển', date: '2024-06-02', type: 'Transport', amount: '200000' }
            ];

            // Hiển thị dữ liệu
            function displayExpenses() {
                $("#expense-table-body").empty();
                $.each(expenses, function (index, expense) {
                    $("#expense-table-body").append("<tr><td>" + expense.name + "</td><td>" + expense.date + "</td><td>" + expense.type + "</td><td>" + expense.amount + "</td><td><button class='edit-expense-btn' data-index='" + index + "'>Sửa</button><button class='delete-expense-btn' data-index='" + index + "'>Xóa</button></td></tr>");
                });
            }

            displayExpenses();

            // Thêm chi phí mới
            $("#add-expense-btn").click(function () {
                var name = $("#expense-name").val();
                var date = $("#expense-date").val();
                var type = $("#expense-type").val();
                var amount = $("#expense-amount").val();

                // Validate dữ liệu
                if (name === "" || date === "" || type === "" || amount === "") {
                    alert("Vui lòng nhập đủ thông tin.");
                    return;
                }

                // Thêm vào mảng và hiển thị lại
                expenses.push({ name: name, date: date, type: type, amount: amount });
                displayExpenses();

                // Xóa nội dung của các trường nhập
                $("#expense-name").val("");
                $("#expense-date").val("");
                $("#expense-type").val("");
                $("#expense-amount").val("");
            });

            // Sửa chi phí
            $(document).on("click", ".edit-expense-btn", function () {
                var index = $(this).data("index");
                var expense = expenses[index];

                // Hiển thị dữ liệu trên form nhập
                $("#expense-name").val(expense.name);
                $("#expense-date").val(expense.date);
                $("#expense-type").val(expense.type);
                $("#expense-amount").val(expense.amount);

                // Ẩn nút Thêm và hiển thị nút Cập nhật
                $("#add-expense-btn").hide();
                $("#update-expense-btn").remove();
                $(".expense-form").append("<button id='update-expense-btn'>Cập nhật</button>");

                // Xử lý sự kiện khi nhấn nút Cập nhật
                $("#update-expense-btn").click(function () {
                    var name = $("#expense-name").val();
                    var date = $("#expense-date").val();
                    var type = $("#expense-type").val();
                    var amount = $("#expense-amount").val();

                    // Validate dữ liệu
                    if (name === "" || date === "" || type === "" || amount === "") {
                        alert("Vui lòng nhập đủ thông tin.");
                        return;
                    }

                    // Cập nhật dữ liệu và hiển thị lại
                    expenses[index] = { name: name, date: date, type: type, amount: amount };
                    displayExpenses();

                    // Xóa nội dung của các trường nhập và hiển thị lại nút Thêm
                    $("#expense-name").val("");
                    $("#expense-date").val("");
                    $("#expense-type").val("");
                    $("#expense-amount").val("");
                    $("#add-expense-btn").show();
                    $("#update-expense-btn").remove();
                });
            });

            // Xóa chi phí
            $(document).on("click", ".delete-expense-btn", function () {
                if (confirm("Bạn có chắc chắn muốn xóa mục này không?")) {
                    var index = $(this).data("index");
                    expenses.splice(index, 1);
                    displayExpenses();
                }
            });

        })
    </script>
</body>

</html>